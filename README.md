# DSX ERP 系统

一个基于 Next.js + FastAPI + PostgreSQL 的现代化ERP系统，专注于采购和仓库管理，支持多件装组合商品管理。

![系统状态](https://img.shields.io/badge/状态-生产就绪-brightgreen)
![技术栈](https://img.shields.io/badge/技术栈-Next.js%20%2B%20FastAPI-blue)
![数据库](https://img.shields.io/badge/数据库-PostgreSQL-336791)

## 🌟 系统特色

### 💡 核心亮点
- **完整的库存流转流程**：在途 → 半成品 → 成品 → 出库的全流程管理
- **智能组合商品管理**：支持多件装商品，自动计算可组装数量
- **包材消耗自动化**：商品打包时自动消耗对应包材库存
- **实时库存预警**：智能显示库存状态（缺货/偏低/充足）
- **权限动态控制**：基于用户角色的界面元素动态显示
- **图片上传管理**：完整的商品图片上传、预览和管理功能

### 🎯 业务价值
- **提升采购效率**：标准化采购流程，支持批量操作
- **精确库存管理**：多状态库存跟踪，避免缺货和积压
- **简化用户操作**：直观的界面设计，降低学习成本
- **数据完整性保障**：数据库层面约束，确保业务数据准确性

## 🏗️ 技术架构

### 前端技术栈
- **框架**: Next.js 14 (App Router)
- **UI组件库**: shadcn/ui + Radix UI
- **样式**: Tailwind CSS
- **状态管理**: Zustand
- **表单处理**: React Hook Form + Zod
- **HTTP客户端**: Axios
- **图标**: Lucide React
- **表格**: TanStack Table

### 后端技术栈
- **框架**: FastAPI
- **数据库**: PostgreSQL
- **ORM**: SQLAlchemy 2.0 (异步)
- **数据库迁移**: Alembic
- **身份验证**: JWT + FastAPI Security
- **数据验证**: Pydantic v2
- **文件处理**: pandas (Excel导入)
- **密码加密**: passlib[bcrypt]

## 📁 项目结构

```
dsx_erp/
├── frontend/                    # Next.js 前端项目
│   ├── app/                    # Next.js App Router
│   │   ├── login/             # 登录页面
│   │   └── dashboard/         # 仪表板模块
│   │       ├── users/         # 用户管理
│   │       ├── suppliers/     # 供应商管理
│   │       ├── supplier-products/ # 供货关系管理
│   │       ├── warehouses/    # 仓库管理
│   │       ├── products/      # 商品管理
│   │       ├── combo-products/ # 组合商品管理
│   │       ├── purchase-orders/ # 采购订单管理
│   │       └── inventory/     # 库存管理
│   ├── components/            # React组件
│   │   ├── ui/               # shadcn/ui组件
│   │   └── dashboard/        # 仪表板组件
│   ├── stores/               # Zustand状态管理
│   ├── types/                # TypeScript类型定义
│   └── lib/                  # 工具函数
├── backend/                   # FastAPI 后端项目
│   ├── app/
│   │   ├── api/              # API路由
│   │   │   └── api_v1/
│   │   │       └── endpoints/ # API端点
│   │   ├── core/             # 核心配置
│   │   ├── models/           # SQLAlchemy数据模型
│   │   ├── schemas/          # Pydantic模式
│   │   └── middleware/       # 中间件
│   ├── alembic/              # 数据库迁移
│   ├── uploads/              # 文件上传目录
│   ├── logs/                 # 日志文件
│   └── main.py               # FastAPI应用入口
└── docs/                      # 项目文档
```

## ✨ 核心功能模块

### 1. 用户认证与权限管理 🔐
- JWT身份验证机制
- 用户登录/登出功能
- 基于角色的权限控制（管理员/普通用户）
- 用户CRUD管理（仅管理员）

### 2. 供应商管理 🏢
- 供应商信息CRUD操作
- 结算方式管理（款到发货/货到付款）
- 供应商名称唯一性校验
- 供货关系管理（支持Excel批量导入）

### 3. 仓库与商品管理 📦
- 仓库基本信息管理
- 商品信息管理（SKU、名称、类型）
- 商品图片上传与管理
- 销售方式分类（商品/包材）
- 包材关联关系管理

### 4. 组合商品管理 🎁
- 多件装商品创建与管理
- 基础商品组合关系设置
- 智能可组装数量计算
- 组合商品组装与出库操作
- 分层库存展示

### 5. 采购订单管理 📋
- 采购订单创建与管理
- 多商品明细支持
- 自动价格计算
- 订单状态跟踪（待收货→部分到货→已完成）
- 到货记录功能（支持部分到货）

### 6. 智能库存管理 📊
- **四阶段库存状态**：在途 → 半成品 → 成品 → 出库
- **自动库存更新**：采购订单创建时自动增加在途库存
- **智能业务逻辑**：
  - 商品打包时自动消耗对应包材
  - 组合商品组装时自动消耗基础商品
  - 库存不足时智能预警
- **分层库存展示**：基础商品与组合商品分别展示
- **实时库存计算**：动态计算可用库存和可组装数量

### 7. 文件上传系统 📁
- 商品图片上传与预览
- 文件类型和大小验证
- 本地文件存储管理
- Excel文件批量导入功能

## 🚀 快速开始

### 环境要求
- **Python**: 3.11+
- **Node.js**: 18+
- **PostgreSQL**: 14+

### 1. 克隆项目
```bash
git clone <repository-url>
cd dsx_erp
```

### 2. 后端设置
```bash
cd backend

# 创建虚拟环境
python -m venv .venv
.\.venv\Scripts\activate  # Windows
# source .venv/bin/activate  # Linux/Mac

# 安装依赖
pip install -r requirements.txt

# 数据库设置（PostgreSQL）
# 创建数据库：dsx_erp

# 运行数据库迁移
alembic upgrade head

# 创建管理员用户
python create_admin.py

# 启动后端服务
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### 3. 前端设置
```bash
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 4. 访问系统
- **前端界面**: http://localhost:3000
- **后端API**: http://localhost:8000
- **API文档**: http://localhost:8000/docs

### 5. 默认账户
- **用户名**: admin
- **密码**: admin123
- ⚠️ **请及时修改默认密码！**

## 📖 使用指南

### 基础操作流程

#### 1. 系统初始化
1. 创建仓库（仓库管理）
2. 创建供应商（供应商管理）
3. 创建基础商品和包材（商品管理）
4. 设置供货关系（供货关系管理）

#### 2. 采购流程
1. 创建采购订单 → 系统自动增加商品在途库存
2. 记录商品到货 → 在途库存转为半成品库存
3. 执行商品打包 → 半成品转为成品（自动消耗包材）
4. 执行商品出库 → 成品转为出库记录

#### 3. 组合商品管理
1. 创建组合商品，设置基础商品组合关系
2. 系统自动计算可组装数量（基于基础商品库存）
3. 执行组合商品组装 → 消耗基础商品成品库存
4. 执行组合商品出库 → 管理组合商品销售

## 🔧 开发指南

### 常用命令

#### 后端开发
```bash
# 启动开发服务器
uvicorn main:app --reload

# 生成数据库迁移
alembic revision --autogenerate -m "描述"

# 应用迁移
alembic upgrade head

# 查看迁移历史
alembic history
```

#### 前端开发
```bash
# 开发模式
npm run dev

# 构建生产版本
npm run build

# 启动生产服务器
npm start

# 类型检查
npm run type-check

# 代码检查
npm run lint
```

### API文档
访问 http://localhost:8000/docs 查看完整的API文档，包括：
- 认证接口
- 用户管理接口
- 供应商管理接口
- 商品管理接口
- 组合商品管理接口
- 采购订单接口
- 库存管理接口
- 文件上传接口

## 🎯 系统完成度

- **基础功能模块**: 100% ✅
- **核心业务流程**: 100% ✅  
- **用户界面**: 100% ✅
- **数据完整性**: 100% ✅
- **权限控制**: 100% ✅
- **文件上传系统**: 100% ✅
- **组合商品管理**: 100% ✅

## 📊 功能统计

- **前端页面**: 12个主要功能页面
- **API接口**: 60+ RESTful API接口
- **数据模型**: 15+ 核心业务实体
- **UI组件**: 20+ 可复用组件

## 🛠️ 技术特色

### 性能优化
- **异步数据库操作**：使用SQLAlchemy 2.0异步特性
- **并行API调用**：前端并行获取多个API数据
- **关联查询优化**：使用selectinload预加载关联数据
- **响应式设计**：适配不同屏幕尺寸

### 安全特性
- **JWT认证**：安全的用户身份验证
- **权限控制**：基于角色的访问控制
- **数据验证**：前后端双重数据验证
- **文件上传安全**：完整的文件类型和大小验证

### 用户体验
- **直观界面**：现代化的UI设计
- **实时反馈**：操作结果即时反馈
- **智能提示**：库存预警和状态提示
- **响应式布局**：移动端友好

## 📝 更新日志

### v1.5 - 组合商品管理（最新）
- ✅ 完整的组合商品数据模型设计
- ✅ 组合商品CRUD管理功能
- ✅ 智能库存计算（基于基础商品库存动态计算可组装数量）
- ✅ 组合商品组装操作（自动消耗基础商品成品库存）
- ✅ 组合商品出库管理
- ✅ 库存清单分层展示优化

### v1.4 - API路径修复
- ✅ 修复前端API调用路径问题
- ✅ 确保所有下拉选择框正常加载数据

### v1.3 - 库存管理优化
- ✅ 包材类型专用显示逻辑
- ✅ 库存数字右对齐美化
- ✅ 操作功能智能过滤

### v1.2 - 图片上传功能
- ✅ 商品图片本地上传和存储
- ✅ 图片预览和缩略图显示
- ✅ 完整的文件类型和大小验证

### v1.1 - 权限控制优化
- ✅ 普通用户自动隐藏用户管理菜单
- ✅ 基于用户角色的动态权限控制

## 📞 技术支持

如需技术支持或有功能建议，请通过以下方式联系：

- 创建 Issue 描述问题或建议
- 查看项目文档获取详细信息
- 参考 API 文档进行集成开发

## 📄 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

---

**DSX ERP系统** - 让库存管理更智能，让采购流程更高效！ 🚀
