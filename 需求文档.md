# ERP系统需求文档

## 1. 项目概述

### 1.1 项目背景
开发一个简化的ERP系统，专注于采购和仓库管理两个核心功能模块。

### 1.2 项目目标
- 提供高效的采购流程管理
- 实现完整的仓库库存管理
- 支持用户权限管理
- 提供直观的数据展示和操作界面

## 2. 功能需求

### 2.1 用户管理模块

#### 2.1.1 登录功能
- **功能描述**：用户通过用户名/密码进行系统登录
- **权限控制**：区分管理员和普通用户权限

#### 2.1.2 用户管理功能
- **功能描述**：管理员可以进行用户的增删改查操作
- **权限要求**：仅管理员可访问

### 2.2 采购管理模块

#### 2.2.1 采购订单管理
- **创建采购订单**
  - 选择供应商名称（下拉选择）
  - 选择采购人员
  - 选择收货仓库
  - 添加采购商品列表：
    - 选择商品（SKU）
    - 输入采购数量
    - 输入单价
    - 系统自动计算小计
    - 系统自动计算总计

- **到货记录**
  - 针对已创建的采购订单
  - 记录每个商品的实际到货数量
  - 支持部分到货记录

#### 2.2.2 供货管理

##### 2.2.2.1 供应商管理
- **创建供应商**
  - 供应商名称（必填，系统唯一性校验）
  - 结算方式（必选项）：
    - 款到发货
    - 货到付款
  - 备注信息（可选）

##### 2.2.2.2 供货关系管理
- **功能描述**：管理供应商与商品SKU的关联关系
- **录入方式**：
  - 手动录入
  - Excel批量导入
- **数据格式**：供应商名称 + 关联商品SKU

### 2.3 仓库管理模块

#### 2.3.1 商品管理
- **创建商品**
  - 商品名称（必填）
  - 商品SKU（必填，系统唯一性校验）
  - 销售方式（必选项）：
    - 商品
    - 包材
  - 商品图片上传
  - 选择所属仓库
  - 选择包材（当销售方式为"商品"时必填）

#### 2.3.2 仓库管理
- **创建仓库**
  - 仓库名称（必填）
  - 负责人（可选）
  - 备注信息（可选）

#### 2.3.3 仓库清单管理
- **查看方式**：按仓库查看商品库存
- **库存状态分类**：
  - **在途**：采购订单创建时增加数量
  - **半成品**：实际到货时从"在途"转入
  - **成品**：半成品打包后转入（需要消耗对应包材的半成品数量）
  - **出库**：商品出库后的累计数量

## 3. 数据流程

### 3.1 采购到库存流程
1. 创建采购订单 → 对应商品"在途"数量增加
2. 商品到货 → 实际到货数量从"在途"转入"半成品"
3. 商品打包 → "半成品"转入"成品"（同时消耗包材的"半成品"数量）
4. 商品出库 → "成品"数量减少，"出库"数量增加

### 3.2 包材消耗逻辑
- 商品打包时需要检查对应包材的半成品数量是否足够
- 打包成功后，包材的半成品数量相应减少
- 商品的半成品数量转入成品数量

## 4. 特殊需求

### 4.1 多件装商品管理
- **问题描述**：某些商品需要多件打包，形成新的SKU商品（如2条装）
- **解决方案建议**：
  - 在商品管理中增加"组合商品"概念
  - 组合商品关联多个基础商品及其数量关系
  - 仓库清单中分别展示：
    - 基础商品库存
    - 组合商品库存
    - 可组合数量（基于基础商品库存计算）

### 4.2 仓库清单展示优化
- **分层展示**：
  - 第一层：基础商品
  - 第二层：组合商品（可折叠展示）
- **数量计算**：
  - 基础商品：显示实际库存数量
  - 组合商品：显示已组合数量 + 可组合数量
- **颜色标识**：
  - 不同库存状态用不同颜色区分
  - 库存不足时红色预警

## 5. 技术要求

### 5.1 数据完整性
- 所有唯一性字段需要数据库层面约束
- 关键业务数据需要完整性校验

### 5.2 用户体验
- 界面操作直观简便
- 支持批量操作（如Excel导入）
- 提供实时数据计算和展示

### 5.3 扩展性
- 系统架构需要考虑后续功能扩展
- 数据库设计需要支持业务增长

## 6. 数据模型概要

### 6.1 核心实体
- 用户（User）
- 供应商（Supplier）
- 商品（Product）
- 仓库（Warehouse）
- 采购订单（PurchaseOrder）
- 采购明细（PurchaseOrderItem）
- 库存记录（InventoryRecord）
- 供货关系（SupplierProduct）

### 6.2 关键关系
- 用户 → 采购订单（一对多）
- 供应商 → 采购订单（一对多）
- 仓库 → 商品（一对多）
- 商品 → 库存记录（一对多）
- 采购订单 → 采购明细（一对多）
- 供应商 → 供货关系 ← 商品（多对多）

## 7. 实施建议

### 7.1 开发优先级
1. 用户管理和登录功能
2. 基础数据管理（仓库、商品、供应商）
3. 采购订单基础功能
4. 库存管理基础功能
5. 到货记录和库存状态转换
6. 组合商品和高级库存展示

### 7.2 技术选型
- **前端**：Next.js + shadcn/ui + Tailwind CSS
- **后端**：FastAPI + Python
- **数据库**：PostgreSQL
- **文件处理**：pandas（Excel导入）
- **权限管理**：JWT + FastAPI Security
- **ORM**：SQLAlchemy 2.0 + Alembic（数据库迁移）

---

**文档版本**：v1.0  
**创建日期**：2025年  
**最后更新**：2025年
